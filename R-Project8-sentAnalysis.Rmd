---
title: "Sentiment Analysis"
author: "Henry Fong, Ian Zhang, Adam Walters"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning  = FALSE}
library(rio)
library(readxl)
library(openxlsx)
library(tm)
library(wordcloud)
library(SnowballC)
library(RColorBrewer)
library(tidyverse)
library(MASS)
library(qdap)
```

```{r}
df <- read_csv("ChatGPT_ResponsesOnAI.csv")

```

```{r}


# Function to remove unknown characters
remove_unknown_characters <- function(text) {
  encoding <- "UTF-8"
  clean_text <- iconv(text, to = encoding, sub = "")
  return(clean_text)
}

# Apply the function to each document in the corpus
# Function to remove unknown characters
remove_unknown_characters <- function(text) {
  encoding <- "UTF-8"
  clean_text <- iconv(text, to = encoding, sub = "")
  return(clean_text)
}

# Apply the function to each element in the df$Response column
df$Response <- sapply(df$Response, remove_unknown_characters)

# Further text preprocessing on df$Response
df$Response <- tolower(df$Response)
df$Response <- gsub("[0-9]", "", df$Response)  # remove numbers
df$Response <- removeWords(df$Response, stopwords("english"))
df$Response <- removePunctuation(df$Response)
df$Response <- stripWhitespace(df$Response)
df$Response <- removeWords(df$Response, c("ai"))
df$Response <- stemDocument(df$Response)


```



```{r}
# Sentiment analysis
p2 <- polarity(df$Response, group = df$Number,
               polarity.frame = key.pol, negators = negation.words,
               amplifiers = amplification.words,
               deamplifiers = deamplification.words,
               n.before = 2, n.after = 2)


# Handle NaN values
p2$all$polarity[is.nan(p2$all$polarity)] <- 0
```

```{r}
print(p2$all$wc)

```

```{r}
# Create a matrix for pairwise comparisons
polarity_matrix <- matrix(NA, nrow = nrow(df), ncol = nrow(df))

# Fill the matrix with pairwise sentiment scores
for (i in 1:nrow(df)) {
  for (j in 1:nrow(df)) {
    # Skip self-comparison
    if (i != j) {
      polarity_matrix[i, j] <- p2$all$polarity[i] - p2$all$polarity[j]
    }
  }
}

# Convert the matrix to a data frame for easier analysis
polarity_df <- as.data.frame(polarity_matrix)
colnames(polarity_df) <- paste("Doc", 1:nrow(df), sep = "")

# Display the polarity matrix
print("Polarity Matrix:")
print(polarity_df)

```




```{r}
# Assuming you have already calculated polarity scores using the polarity function
# ...

# Extract relevant information for plotting
doc_numbers <- df$Number
polarity_values <- p2$all$polarity

# Create a data frame for plotting
polarity_df <- data.frame(Document = doc_numbers, Polarity = polarity_values)

# Plotting the bar plot
library(ggplot2)

ggplot(polarity_df, aes(x = factor(Document), y = Polarity, fill = factor(Document))) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  labs(title = "Sentiment Scores by Document",
       x = "Document Number",
       y = "Sentiment Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

