---
title: "Sentiment Analysis"
author: "Henry Fong, Ian Zhang, Adam Walters"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning  = FALSE}
library(rio)
library(readxl)
library(openxlsx)
library(tm)
library(wordcloud)
library(SnowballC)
library(RColorBrewer)
library(tidyverse)
library(MASS)
library(qdap)
```

```{r}
df <- read_csv("ChatGPT_ResponsesOnAI.csv")

```

```{r}

# Create a corpus
corpG <- Corpus(VectorSource(df$Response))

# Function to remove unknown characters
remove_unknown_characters <- function(text) {
  encoding <- "UTF-8"
  clean_text <- iconv(text, to = encoding, sub = "")
  return(clean_text)
}

# Apply the function to each document in the corpus
corpG <- tm_map(corpG, content_transformer(remove_unknown_characters))

# Further text preprocessing
corpG <- tm_map(corpG, content_transformer(tolower))
corpG <- tm_map(corpG, removeNumbers)
corpG <- tm_map(corpG, removeWords, stopwords("english"))
corpG <- tm_map(corpG, removePunctuation)
corpG <- tm_map(corpG, stripWhitespace)
corpG <- tm_map(corpG, removeWords, c("ai"))

# Stemming
corpG <- tm_map(corpG, stemDocument)

# Sentiment analysis
p2 <- polarity(corpG, group = df$Number,
               polarity.frame = key.pol, negators = negation.words,
               amplifiers = amplification.words,
               deamplifiers = deamplification.words,
               n.before = 2, n.after = 2)

# Handle NaN values
p2$all$polarity[is.nan(p2$all$polarity)] <- 0


```

```{r}
# Create a matrix for pairwise comparisons
polarity_matrix <- matrix(NA, nrow = nrow(df), ncol = nrow(df))

# Fill the matrix with pairwise sentiment scores
for (i in 1:nrow(df)) {
  for (j in 1:nrow(df)) {
    # Skip self-comparison
    if (i != j) {
      polarity_matrix[i, j] <- p2$all$polarity[i] - p2$all$polarity[j]
    }
  }
}

# Convert the matrix to a data frame for easier analysis
polarity_df <- as.data.frame(polarity_matrix)
colnames(polarity_df) <- paste("Doc", 1:nrow(df), sep = "")

# Display the polarity matrix
print("Polarity Matrix:")
print(polarity_df)

```

```{r}
# Install and load required library

library(RColorBrewer)

# Create a heatmap
heatmap(polarity_matrix, 
        col = colorRampPalette(c("red", "white", "green"))(100),
        main = "Pairwise Sentiment Differences",
        xlab = "Documents",
        ylab = "Documents",
        cex.lab = 1.5,
        cex.axis = 1.5,
        cex.main = 1.5,
        margins = c(10, 10),
        key.title = NA,
        key.xlab = "Sentiment Difference",
        key.ylab = NULL,
        trace = "none"
)

```


